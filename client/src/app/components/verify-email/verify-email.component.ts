import { Component } from '@angular/core';
import { FormBuilder, FormControl, FormGroup, Validators } from '@angular/forms';
import { AuthService } from 'src/app/services/auth.service';

@Component({
  selector: 'app-verify-email',
  templateUrl: './verify-email.component.html',
  styleUrls: ['./verify-email.component.css']
})

export class VerifyEmailComponent {

  emailForm!: FormGroup;

  constructor(private fb: FormBuilder, private authService: AuthService) { }

  //Initialize a FormGroup with validation
  ngOnInit() : void {
    this.emailForm = this.fb.group({
      userEmail: this.fb.control('', [ Validators.required, Validators.email ]),
    });
  }

  //Method that returns true if form input is not pristine and invalid
  invalidControl (ctrlName: string): boolean {
    const ctrl = this.emailForm.get(ctrlName) as FormControl;
    return ctrl.invalid && (!ctrl.pristine);
  }

  //Send the email string to server and save the email in localStorage
  //Form data is cleared after 3min
  submitEmail() {
    const email = this.emailForm.value.userEmail;
    localStorage.setItem("userEmail", email)
    this.authService.verifyEmail(email);
    setTimeout(() => {
      this.emailForm.reset();
      localStorage.removeItem("userEmail");
    }, 180000);
  }

}